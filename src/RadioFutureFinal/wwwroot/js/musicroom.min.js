function searchTextChanged(n){var t=$("#div_search_results");n.length==0&&t.fadeOut()}function searchEnterPressed(n){var t=$("#div_search_results");t.html("");searchVideos(n.val(),function(n){$.each(n.items,function(n,i){t.html(t.html()+"<div class='div_search_result' onClick='queueSelectedVideo(this)' data-VideoId='"+i.id.videoId+"' data-ThumbURL='"+i.snippet.thumbnails.medium.url+'\'><p class="text_search_result">'+i.snippet.title+"<\/p><\/div>")})});t.is(":visible")||t.fadeIn()}function sessionReadyUI(){mGlobals.ui.div_loading.hide();mGlobals.ui.spinner.stop();mGlobals.ui.div_everything.animate({opacity:1},"fast")}function onPlayerReady(){mGlobals.player_ready=!0;mGlobals.youtube_api_ready&&setupJamSession()}function queueRollover(n){$(n).attr("src","../images/cross.jpg");$(n).attr("onclick","deleteVideoInQueue("+n.getAttribute("data-QueuePosition")+")")}function queueRolloff(n){$(n).attr("src",n.getAttribute("data-ThumbURL"))}function updateQueueUI(n){var u=mGlobals.queue,h=u.length,t=u.length-n,f=t+" things up next",s,e,i,r,o;if(t==1?f=t+" thing up next":t<=0&&(f="Nothing up next. Queue something!"),$("#p_queue_summary").text(f),s=$("#div_queue_results"),e=[],t>0)for(i=n;i<h;i++)r=u[i],o="",o=mobileBrowser?'<img style="float: left; width: 33.33%; height: 20vw;" src="'+r.ThumbURL+'"/>':'<div style="text-align: left; display: flex; align-items: center;"><img style="height: 90px; width: 160px; margin-right: 16px;" src="'+r.ThumbURL+'"/><span style="margin-right: 16px;">'+r.VideoTitle+"<\/span><\/div>",e.push(o);s.html(e.join(""))}function updateUsersListUI(n){var r,t,u,i;console.log("Updating users list");r=n.length;t=n.length+" users in the room";r==1&&(t=n.length+" user in the room");$("#p_users_summary").text(t);u=$("#div_user_results");i=[];$.each(n,function(n,t){var u="Nothing",r;t.QueuePosition!=-1&&(u=mGlobals.queue[t.QueuePosition].VideoTitle);r="";r=mobileBrowser?'<div onclick="syncWithUser('+t.Id+')" class="div_user" style="background: '+COLOR_LIST[n%COLOR_LIST.length]+';">sync with '+t.Name+"<\/div>":'<div style="text-align: left; display: flex; align-items: center;"><div onclick="syncWithUser('+t.Id+')" style="display: flex; align-items: center; justify-content: center; float: left; cursor: pointer; margin-right: 16px; height: 48px; width: 48px; background: '+COLOR_LIST[n%COLOR_LIST.length]+';">sync<\/div><span style="margin-right: 16px; float: right;">'+t.Name+'<br /><span style="font-size: 12px";>'+u+"<\/span><\/span><\/div>";i.push(r)});u.html(i.join(""))}function setupVideo(){if(mGlobals.user.QueuePosition!=-1){var n=mGlobals.queue[mGlobals.user.QueuePosition];updateQueueUI(mGlobals.user.QueuePosition+1);updatePlayerUI(n,mGlobals.user.VideoTime,n.UserName)}}function UserNameChange(n){n.hide();mGlobals.ui.input_search.fadeIn();saveUserNameChange(n.val())}function deleteVideoInQueue(n){var i=mGlobals.queue[n].Id,t;mGlobals.queue.splice(n,1);updateQueueUI(mGlobals.user.QueuePosition+1);t={Media:{Id:i}};mGlobals.socket.emit("deleteMediaFromSession",t)}function previousVideoInQueue(){var n,t;mGlobals.user.VideoTime=0;n=mGlobals.queue;mGlobals.user.QueuePosition>0&&(t=mGlobals.user.QueuePosition=mGlobals.user.QueuePosition-1,setupVideo(),mGlobals.user.waiting=!1);saveUserVideoState()}function playVideo(){$("#btn_play").hide();$("#btn_pause").show();mGlobals.player.playVideo()}function pauseVideo(){$("#btn_pause").hide();$("#btn_play").show();mGlobals.player.pauseVideo()}function nextVideoInQueue(){var n,t;mGlobals.user.VideoTime=0;n=mGlobals.queue;mGlobals.user.QueuePosition+1<n.length?(t=mGlobals.user.QueuePosition=mGlobals.user.QueuePosition+1,setupVideo(),mGlobals.user.waiting=!1):mGlobals.user.waiting=!0;saveUserVideoState()}function queueSelectedVideo(n){mGlobals.ui.div_search_results.fadeOut();mGlobals.ui.input_search.val("");var t=n.getAttribute("data-VideoId"),i=n.innerText||element.textContent,r=n.getAttribute("data-ThumbURL"),u=createMedia(i,t,r,mGlobals.user.Id,mGlobals.user.Name),f={Media:u};mGlobals.socket.emit("addMediaToSession",f)}function syncWithUser(n){for(var t={},i=0;i<mGlobals.current_users.length;i++)mGlobals.current_users[i].Id===n&&(t=mGlobals.current_users[i]);mGlobals.user.QueuePosition=t.QueuePosition;mGlobals.user.VideoTime=t.VideoTime;mGlobals.user.YtPlayerState=t.YtPlayerState;updateQueueUI(mGlobals.user.QueuePosition+1);setupVideo()}function saveUserNameChange(n){var t,i;for(mGlobals.user.Name=n,t=0;t<mGlobals.current_users;t++)mGlobals.user.Id===mGlobals.current_users[t].Id&&(mGlobals.current_users[t].name=n);i={User:mGlobals.user};mGlobals.socket.emit("saveUserNameChange",i)}function saveUserVideoState(){if(mGlobals.player_ready){mGlobals.user.VideoTime=Math.round(mGlobals.player.getCurrentTime());mGlobals.user.YtPlayerState=mGlobals.player.getPlayerState();var n={User:mGlobals.user};mGlobals.socket.emit("SaveUserVideoState",n)}}function synchronizeUsers(){var n={Session:{Id:mGlobals.sessionId}};mGlobals.socket.emit("synchronizeUsers",n)}function updateUser(n){var t=n.user;mGlobals.sessionInitialized&&(mGlobals.user=t)}function sessionReady(n){var t=n.Session;mGlobals.sessionId=t.Id;mGlobals.queue=t.Queue;mGlobals.current_users=t.Users;mGlobals.user=n.User;saveUserVideoState();setInterval(saveUserVideoState,5e3);mGlobals.queue.length==0&&($("#p_current_content_info").text("Queue up a song!"),$("#p_current_recommender_info").text("Use the search bar above."));nextVideoInQueue();updateUsersListUI(mGlobals.current_users);sessionReadyUI(mGlobals.session.name);mGlobals.sessionInitialized=!0}function updateUsersList(n){var t=n.Session.Users;console.log(t);mGlobals.sessionInitialized&&(mGlobals.current_users=t,updateUsersListUI(mGlobals.current_users))}function updateQueue(n){var t=n.Session.Queue;mGlobals.sessionInitialized&&(mGlobals.queue=t,updateQueueUI(mGlobals.user.QueuePosition+1),mGlobals.user.waiting&&nextVideoInQueue())}function receivedChatMessage(n){var t=n.ChatMessage,i=n.User.Name,u=$("#ul_chat").length,r='<li class="chat"><span style="margin: 0; color: '+COLOR_LIST[length%6]+';">'+i+": <\/span><span>"+t+"<\/span><\/li>";$("#ul_chat").append(r)}function setupSockets(){var t="ws://"+window.location.host+"/ws",n=new WebSocket(t);n.onopen=function(){};n.onclose=function(){};n.onmessage=function(n){var t=JSON.parse(n.data),i=t.Action,r=messageFunctions[i];messageFunctions[i](t)};n.onerror=function(){};n.emit=function(t,i){if(n.readyState===n.CONNECTING){setTimeout(function(){n.emit(t,i)},100);return}var r={action:t,session:i.Session,media:i.Media,user:i.User,chatMessage:i.ChatMessage};n.send(JSON.stringify(r))};mGlobals.socket=n}function setupJamSession(){if(!mGlobals.entered_jam){mGlobals.entered_jam=!0;var n=window.location.pathname,t=null;n.indexOf("/rooms/")>-1&&(t=n.replace("/rooms/",""));setupSockets();setTimeout(function(){joinJamSession(t)},50)}}function joinJamSession(n){mGlobals.session.name=decodeURI(n);mGlobals.user=createTempUser("Anonymous");var t={User:mGlobals.user,Session:{name:n}};mGlobals.socket.emit("userJoinSession",t)}function sendChatMessage(n){if(mGlobals.sessionInitialized){var t={ChatMessage:n,User:{Name:mGlobals.user.Name}};console.log("sending chat message");console.log(t);mGlobals.socket.emit("chatMessage",t)}}function youtubeAPIInit(){gapi.client.setApiKey("AIzaSyC4A-dsGk-ha_b-eDpbxaVQt5bR7cOUddc");gapi.client.load("youtube","v3",function(){mGlobals.youtube_api_ready=!0;mGlobals.player_ready&&setupJamSession()})}function onYouTubeIframeAPIReady(){if(mGlobals.player=new YT.Player("div_player",{height:"auto",width:"100%",playerVars:{controls:1,showinfo:0,autoplay:0},events:{onReady:onPlayerReady,onStateChange:onPlayerStateChange}}),mobileBrowser){var n=$("#div_player");n.height(n.width()*9/16)}}function searchVideos(n,t){var i=gapi.client.youtube.search.list({part:"snippet",type:"video",q:encodeURIComponent(n).replace(/%20/g,"+"),maxResults:5});i.execute(t)}function onPlayerStateChange(n){n.data==0&&nextVideoInQueue()}function updatePlayerUI(n,t,i){if(mGlobals.player_ready||setTimeout(updatePlayerUI(n,t,i),1e3),mGlobals.player.loadVideoById(n.YTVideoID,t,"large"),$("#p_cc_summary").text(n.VideoTitle),!mobileBrowser){var r='<div style="text-align: left; display: flex; align-items: center;"><img style="height: 90px; width: 160px; margin-right: 16px;" src="'+n.ThumbURL+'"/><span style="margin-right: 16px;">'+n.VideoTitle+"<br>Recommended by: "+i+"<\/span><\/div>";$("#div_cc_results").html(r)}synchronizeUsers()}function createMedia(n,t,i,r,u){return{YTVideoId:t,VideoTitle:n,ThumbURL:i,UserName:u,UserId:r}}function createTempUser(n){var t={};return t.temp=!0,t.name=n,t.QueuePosition=-1,t.VideoTime=-1,t.YtPlayerState=-1,t.color=getRandomColor(),t}function getRandomColor(){for(var i="0123456789ABCDEF".split(""),n="#",t=0;t<6;t++)n+=i[Math.floor(Math.random()*16)];return n}var mConstants,mGlobals,messageFunctions;window.mobilecheck=function(){var n=!1;return function(t){(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(t)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(t.substr(0,4)))&&(n=!0)}(navigator.userAgent||navigator.vendor||window.opera),n};$(document).ready(function(){var i=window.location.pathname,f=null,r,u,n,t;i.indexOf("/rooms/")>-1&&(f=i.replace("/rooms/",""));mGlobals.ui.div_loading=$("#div_loading");mGlobals.ui.div_everything=$("#div_everything");r={lines:13,length:28,width:14,radius:42,scale:1,corners:1,color:"#000",opacity:.25,rotate:0,direction:1,speed:1,trail:60,fps:20,zIndex:2e9,className:"spinner",top:"50%",left:"50%",shadow:!1,hwaccel:!1,position:"absolute"};u=document.getElementById("div_loading");mGlobals.ui.spinner=new Spinner(r).spin(u);mGlobals.ui.input_search=$("#input_search");mGlobals.ui.input_name=$("#input_name");mGlobals.ui.input_chat=$("#chat_input");mGlobals.ui.ul_chat=$("#ul_chat");mGlobals.ui.div_search_results=$("#div_search_results");mGlobals.ui.input_search.bind("propertychange input paste",function(){searchTextChanged($("#input_search").val())});n=function(n,t){n.mouseenter(function(){t.is(":visible")||t.fadeIn()});n.mouseleave(function(){t.is(":visible")&&t.fadeOut()})};n($("#div_users_overall"),$("#div_user_results"));n($("#div_queue_overall"),$("#div_queue_results"));n($("#div_chat_overall"),$("#div_chat_results"));n($("#div_cc_overall"),$("#div_cc_results"));mGlobals.ui.input_search.keypress(function(n){n.which==13&&searchEnterPressed(mGlobals.ui.input_search)});mGlobals.ui.input_name.keypress(function(n){n.which==13&&UserNameChange(mGlobals.ui.input_name)});t=$("#input_chat");t.keypress(function(n){n.which==13&&(sendChatMessage(t.val()),t.val(""))});$("#btn_previous").click(previousVideoInQueue);$("#btn_pause").click(pauseVideo);$("#btn_play").click(playVideo);$("#btn_next").click(nextVideoInQueue);document.body.addEventListener("click",function(){mGlobals.ui.div_search_results.fadeOut();mGlobals.input_search&&mGlobals.input_search.val("")},!0)});mConstants={PLAYING:1,PAUSED:2};mGlobals={sessionInitialized:!1,player_ready:!1,url_room:null,youtube_api_ready:!1,entered_jam:!1,player:{},user:{},session:{},queue:[],current_users:[],ui:{}};COLOR_LIST=["red","orange","yellow","green","blue","violet"];messageFunctions={updateUser:updateUser,sessionReady:sessionReady,updateUsersList:updateUsersList,updateQueue:updateQueue,chatMessage:receivedChatMessage};
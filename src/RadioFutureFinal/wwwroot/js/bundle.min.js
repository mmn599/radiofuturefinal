(function e(n,t,i){function r(u,e){var s,h,o;if(!t[u]){if(!n[u]){if(s=typeof require=="function"&&require,!e&&s)return s(u,!0);if(f)return f(u,!0);h=new Error("Cannot find module '"+u+"'");throw h.code="MODULE_NOT_FOUND",h;}o=t[u]={exports:{}};n[u][0].call(o.exports,function(t){var i=n[u][1][t];return r(i?i:t)},o,o.exports,e,n,t,i)}return t[u].exports}for(var f=typeof require=="function"&&require,u=0;u<i.length;u++)r(i[u]);return r})({1:[function(n,t,i){"use strict";var u,f,r,e,o;Object.defineProperty(i,"__esModule",{value:!0});u=function(){function n(){}return n}();i.Media=u;f=function(){function n(){this.State=new r}return n}();i.MyUser=f;r=function(){function n(){this.Time=0;this.QueuePosition=-1;this.YTPlayerState=0;this.Waiting=!1}return n}();i.UserState=r;e=function(){function n(){}return n}();i.Session=e;o=function(){function n(){}return n}();i.WsMessage=o},{}],2:[function(n,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var r=function(){function n(n){this.mobileBrowser=n}return n.prototype.user=function(n,t,i,r){var u=r?'onclick="requestSyncWithUser('+t+')" ':"",f=r?"you":"sync",e=r?"you":"sync with "+i;return this.mobileBrowser?"<div "+u+'class="div_user" style="background: '+n+';"> '+e+"<\/div>":'<div style="text-align: left; display: flex; align-items: center;"><div '+u+'style="display: flex; align-items: center; justify-content: center; float: left; cursor: pointer; margin-right: 16px; height: 48px; width: 48px; background: '+n+';">'+f+'<\/div><span style="margin-right: 16px; float: right;">'+i+"<\/span><\/div>"},n.prototype.media=function(n,t,i,r){var u=i&&!r,e=u?'title="Click to delete this from the queue!" onclick="deleteMedia('+n.Id+", "+t+')" ':"",o=u?"cursor: pointer; ":"",f=r?"border: 1px solid blue; ":"";return this.mobileBrowser?'<img style="'+f+'float: left; width: 33.33%; height: 20vw;" src="'+n.ThumbURL+'"/>':"<div "+e+'style="'+o+f+'text-align: left; display: flex; align-items: center;"><img style="height: 90px; width: 160px; margin-right: 16px;" src="'+n.ThumbURL+'"/><span style="margin-right: 16px;">'+n.VideoTitle+"<\/span><\/div>"},n}();i.FrameBuilder=r},{}],3:[function(n,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var r=function(){function n(n){var t=this;this.onPlayerReady=function(){t.playerReady=!0};this.playerReady=!1;this.mobileBrowser=n}return n.prototype.initializeYtPlayer=function(n){if(this.ytPlayer=new YT.Player("div_yt_player",{height:"auto",width:"100%",playerVars:{controls:1,showinfo:0,autoplay:0},events:{onReady:this.onPlayerReady,onStateChange:n}}),this.mobileBrowser){var t=$("#div_player");t.height(t.width()*9/16)}},n.prototype.setPlayerContent=function(n,t){var i=this;this.playerReady?(this.updatePlayerUI(n,t),this.play()):(console.log("player not ready!"),setTimeout(function(n,t){i.setPlayerContent(n,t)},50))},n.prototype.play=function(){this.ytPlayer.playVideo()},n.prototype.pause=function(){this.ytPlayer.pauseVideo()},n.prototype.getCurrentTime=function(){return Math.round(this.ytPlayer.getCurrentTime())},n.prototype.getCurrentState=function(){return Math.round(this.ytPlayer.getPlayerState())},n.prototype.updatePlayerUI=function(n,t){if(this.ytPlayer.loadVideoById(n.YTVideoID,t,"large"),$("#p_cc_summary").text(n.VideoTitle),!this.mobileBrowser){var i='<div style="text-align: left; display: flex; align-items: center;"><img style="height: 90px; width: 160px; margin-right: 16px;" src="'+n.ThumbURL+'"/><span style="margin-right: 16px;">'+n.VideoTitle+"<br>Recommended by: "+n.UserName+"<\/span><\/div>";$("#div_cc_results").html(i)}},n}();i.Player=r},{}],4:[function(n,t,i){"use strict";function p(){var t=window.location.pathname,i=t.replace("/rooms/",""),n;u.Name=decodeURI(i);r.Name="Anonymous";n=new f.WsMessage;n.Action="UserJoinSession";n.User=r;n.Session=u;o.emit(n)}function w(){s.initializeYtPlayer(k)}function b(){gapi.client.setApiKey("AIzaSyC4A-dsGk-ha_b-eDpbxaVQt5bR7cOUddc");gapi.client.load("youtube","v3",function(){})}function k(n){n.data==0&&c()}function d(n){var t=n.User,i;r.State.QueuePosition=t.State.QueuePosition;r.State.Time=t.State.Time;r.State.YTPlayerState=t.State.YTPlayerState;e.updateQueue(u.Queue,r.Id,r.State.QueuePosition);i=u.Queue[r.State.QueuePosition];h()}function g(n){var t=new f.MyUser,i;t.Id=n.User.Id;t.State.QueuePosition=r.State.QueuePosition;t.State.Time=Math.round(s.getCurrentTime());t.State.YTPlayerState=s.getCurrentState();i=new f.WsMessage;i.Action="ProvideSyncToUser";i.User=t;o.emit(i)}function nt(n){var t=n.User;r=t}function tt(n){u=n.Session;r=n.User;u.Queue.length==0&&($("#p_current_content_info").text("Queue up a song!"),$("#p_current_recommender_info").text("Use the search bar above."));c();e.updateUsersList(u.Users,r.Id);e.sessionReady()}function it(n){var t=n.Session.Users;u.Users=t;e.updateUsersList(u.Users,r.Id)}function rt(n){u.Queue=n.Session.Queue;r.State.Waiting&&c();e.updateQueue(u.Queue,r.Id,r.State.QueuePosition)}function ut(n){var t=n.ChatMessage,i=n.User.Name;e.onChatMessage(i,t)}function ft(n){var t=new f.WsMessage;t.Action="ChatMessage";t.ChatMessage=n;t.User=r;o.emit(t)}function et(n,t){var i=gapi.client.youtube.search.list({part:"snippet",type:"video",q:encodeURIComponent(n).replace(/%20/g,"+"),maxResults:5});i.execute(t)}function ot(n){r.Name=n;var t=new f.WsMessage;t.User=r;t.Action="SaveUserNameChange";o.emit(t)}function h(){r.State.QueuePosition>=0&&r.State.QueuePosition<u.Queue.length?(s.setPlayerContent(u.Queue[r.State.QueuePosition],r.State.Time),r.State.Waiting=!1):r.State.QueuePosition<0||r.State.QueuePosition==u.Queue.length?r.State.Waiting=!0:r.State.QueuePosition==u.Queue.length}function c(){r.State.Time=0;var n=u.Queue;r.State.QueuePosition+1<n.length?r.State.QueuePosition=r.State.QueuePosition+1:r.State.QueuePosition>=0&&(r.State.QueuePosition=n.length);h()}function st(){s.pause()}function ht(){s.play()}function ct(){r.State.Time=0;var n=u.Queue;r.State.QueuePosition>0&&(r.State.QueuePosition=r.State.QueuePosition-1,h())}function lt(n){var i,t;console.log("request sync with user");i=new f.MyUser;i.Id=n;t=new f.WsMessage;t.Action="RequestSyncWithUser";t.User=i;o.emit(t)}function at(n){var i;$("#div_search_results").fadeOut();$("#input_search").val("");var u=n.getAttribute("data-VideoId"),e=n.innerText||n.textContent,s=n.getAttribute("data-ThumbURL"),t=new f.Media;t.YTVideoID=u;t.VideoTitle=e;t.ThumbURL=s;t.UserId=r.Id;t.UserName=r.Name;i=new f.WsMessage;i.Action="AddMediaToSession";i.Media=t;o.emit(i)}function vt(n,t){var s,i;u.Queue.splice(t,1);r.State.QueuePosition>=t&&(r.State.QueuePosition-=1,h());e.updateQueue(u.Queue,r.Id,r.State.QueuePosition);s=new f.Media;s.Id=n;i=new f.WsMessage;i.Action="DeleteMediaFromSession";i.Media=s;o.emit(i)}var a;Object.defineProperty(i,"__esModule",{value:!0});window.onYouTubeIframeAPIReady=w;window.ytApiReady=b;window.queueSelectedVideo=at;window.requestSyncWithUser=lt;window.deleteMedia=vt;var f=n("./Contracts"),l=n("./UI"),v=n("./Sockets"),y=n("./Player"),r=new f.MyUser,u=new f.Session,e,s,o;$(document).ready(function(){var n=new l.UICallbacks;n.onSendChatMessage=ft;n.nameChange=ot;n.nextMedia=c;n.pauseMedia=st;n.playMedia=ht;n.previousMedia=ct;n.search=et;e=new l.UI(mobileBrowser,n);s=new y.Player(mobileBrowser);o=new v.MySocket(a);p()});a={updateUser:nt,sessionReady:tt,updateUsersList:it,updateQueue:rt,ChatMessage:ut,requestUserState:g,provideUserState:d}},{"./Contracts":1,"./Player":3,"./Sockets":5,"./UI":6}],5:[function(n,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var r=function(){function n(n){this.response_functions=n;var i="ws://"+window.location.host+"/ws",t=new WebSocket(i);t.onopen=function(){};t.onclose=function(){};t.onmessage=function(t){var i=JSON.parse(t.data),r=i.Action,u=n[r];u(i)};t.onerror=function(){};this.socket=t}return n.prototype.emit=function(n){var t=this;if(this.socket.readyState===this.socket.CONNECTING){setTimeout(function(){t.emit(n)},100);return}this.socket.send(JSON.stringify(n))},n}();i.MySocket=r},{}],6:[function(n,t,i){"use strict";var r,u,f;Object.defineProperty(i,"__esModule",{value:!0});r=n("./FrameBuilder");u=function(){function n(){}return n}();i.UICallbacks=u;f=function(){function n(n,t){this.colors=["red","orange","yellow","green","blue","violet"];this.mobileBrowser=n;this.frameBuilder=new r.FrameBuilder(n);this.callbacks=t;this.initialize()}return n.prototype.initialize=function(){this.setupSpinnerUI();this.setupInfoRolloverUI();this.setupInputUI();this.setupPlayerControlButtons()},n.prototype.sessionReady=function(){$("#div_loading").hide();this.spinner.stop();$("#div_everything").animate({opacity:1},"fast")},n.prototype.setupSpinnerUI=function(){var n=document.getElementById("div_loading");this.spinner=new Spinner({lines:13,length:28,width:14,radius:42,scale:1,corners:1,color:"#000",opacity:.25,rotate:0,direction:1,speed:1,trail:60,fps:20,zIndex:2e9,className:"spinner",top:"50%",left:"50%",shadow:!1,hwaccel:!1,position:"absolute"}).spin(n)},n.prototype.setupFadeUI=function(n,t){n.mouseenter(function(){t.is(":visible")||t.fadeIn()});n.mouseleave(function(){t.is(":visible")&&t.fadeOut()})},n.prototype.setupInfoRolloverUI=function(){this.mobileBrowser||(this.setupFadeUI($("#div_users_overall"),$("#div_user_results")),this.setupFadeUI($("#div_queue_overall"),$("#div_queue_results")),this.setupFadeUI($("#div_chat_overall"),$("#div_chat_results")),this.setupFadeUI($("#div_cc_overall"),$("#div_cc_results")))},n.prototype.searchTextChanged=function(n){var t=$("#div_search_results");n.length==0&&t.fadeOut()},n.prototype.setupInputUI=function(){var n=this,r=$("#input_search"),i,t;r.keypress(function(t){t.which==13&&n.searchEnterPressed(r)});i=$("#input_name");i.keypress(function(t){t.which==13&&n.userNameChange(i)});this.mobileBrowser||(t=$("#input_chat"),t.keypress(function(i){if(i.which==13){n.callbacks.onSendChatMessage(t.val());t.val("")}}));document.body.addEventListener("click",function(){$("#div_search_results").fadeOut();$("#input_search").val("")},!0);$("#input_search").bind("propertychange input paste",function(){n.searchTextChanged($("#input_search").val())})},n.prototype.setupPlayerControlButtons=function(){var n=this;$("#btn_previous").click(this.callbacks.previousMedia);$("#btn_pause").click(function(){$("#btn_pause").hide();$("#btn_play").show();n.callbacks.pauseMedia()});$("#btn_play").click(function(){$("#btn_play").hide();$("#btn_pause").show();n.callbacks.playMedia()});$("#btn_next").click(this.callbacks.nextMedia)},n.prototype.searchEnterPressed=function(n){var t=$("#div_search_results");t.html("");this.callbacks.search(n.val(),function(i){$.each(i.items,function(n,i){t.html(t.html()+"<div class='div_search_result' onClick='queueSelectedVideo(this)' data-VideoId='"+i.id.videoId+"' data-ThumbURL='"+i.snippet.thumbnails.medium.url+'\'><p class="text_search_result">'+i.snippet.title+"<\/p><\/div>")});n.blur()});t.is(":visible")||t.fadeIn()},n.prototype.updateQueue=function(n,t,i){var u=n.length,f=u+" things in the playlist",o,e,r;for(u==1?f=u+" thing in the playlist":u<=0&&(f="Nothing in the playlist. Queue something!"),$("#p_queue_summary").text(f),o=$("#div_queue_results"),e=[],r=0;r<u;r++){var s=n[r],h=r===i,c=this.frameBuilder.media(s,r,s.UserId===t,h);e.push(c)}o.html(e.join(""))},n.prototype.updateUsersList=function(n,t){var o=n.length,f=n.length+" users in the room",e,r,i;for(o==1&&(f=n.length+" user in the room"),$("#p_users_summary").text(f),e=$("#div_user_results"),r=[],i=0;i<n.length;i++){var u=n[i],s=u.Id===t,h=this.frameBuilder.user(this.colors[i%this.colors.length],u.Id,u.Name,s);r.push(h)}e.html(r.join(""))},n.prototype.userNameChange=function(n){n.hide();$("#input_search").fadeIn();this.callbacks.nameChange(n.val())},n.prototype.onChatMessage=function(n,t){var i='<li class="chat"><span style="margin: 0; color: blue;">'+n+": <\/span><span>"+t+"<\/span><\/li>";$("#ul_chat").append(i)},n}();i.UI=f},{"./FrameBuilder":2}]},{},[1,2,3,4,5,6]);
//# sourceMappingURL=bundle.min.js.map